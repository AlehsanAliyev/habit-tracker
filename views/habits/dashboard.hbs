<div class="page-head">
  <div>
    <h1>Dashboard</h1>
    <p class="page-subtitle">Welcome, {{session.user.username}}. Keep the streak alive.</p>
  </div>
  <div class="page-actions">
    <a class="btn primary" href="/habits/add">Add Habit</a>
  </div>
</div>

{{#if habits.length}}
  <div class="card-grid">
    {{#each habits}}
      <div class="card habit-card">
        <div class="habit-head">
          <h3 class="habit-title">{{title}}</h3>
          <span class="pill">{{frequency}}</span>
        </div>

        <div class="habit-meta">
          {{#if weeklyTarget}}
            <div class="meta-line"><strong>Weekly target:</strong> {{weeklyTarget}}</div>
          {{/if}}
        </div>

        <div class="habit-spacer"></div>

        <div class="heatmap" aria-label="Last seven days">
          {{#each last7Days}}
            <button
              type="button"
              class="heatmap-square heatmap-btn {{#if (eq score 2)}}is-good{{else if (eq score 1)}}is-warn{{else if (eq score 0)}}is-bad{{else if (eq score 'f')}}is-muted{{else}}is-empty{{/if}}"
              data-habit-id="{{../_id}}"
              data-habit-title="{{../title}}"
              data-date="{{date}}"
              data-score="{{score}}">
            </button>
          {{/each}}
        </div>

        <div class="habit-actions">
          <a href="/logs/add/{{_id}}" class="btn primary small">Log today</a>
          <a href="/habits/edit/{{_id}}" class="btn ghost small">Edit</a>
          <a href="/habits/delete/{{_id}}" class="btn danger small" onclick="return confirm('Delete this habit?')">Delete</a>
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <div class="card">
    <p class="card-meta">You have not added any habits yet.</p>
  </div>
{{/if}}

<div class="log-modal" data-log-modal aria-hidden="true">
  <div class="log-modal-backdrop" data-modal-close></div>
  <div class="log-modal-panel card">
    <div class="card-head">
      <h3 class="card-title" data-modal-title>Log</h3>
      <button type="button" class="btn ghost small" data-modal-close>Cancel</button>
    </div>
    <p class="card-meta">Date: <span data-modal-date></span></p>
    <div class="log-options">
      <button type="button" class="btn ghost small score-option" data-score="2">Done</button>
      <button type="button" class="btn ghost small score-option" data-score="1">Partial</button>
      <button type="button" class="btn ghost small score-option" data-score="0">Missed</button>
      <button type="button" class="btn ghost small score-option" data-score="f">Off</button>
    </div>
    <div class="form-actions">
      <button type="button" class="btn primary" data-modal-save>Save</button>
    </div>
  </div>
</div>
